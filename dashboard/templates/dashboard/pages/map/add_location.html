
	    <div id="screen" style="display: none; position: fixed; width: 100%; height: 100%; top: 0; left: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 999;"></div>
	    <div class="dialog" id="addPinModal">
	        <button id="closeDialog" style="float: right;">X</button>
	        <h2>Add Location</h2>
	        <form method="POST" hx-post="{% url 'add_pin' %}" hx-trigger="submit" hx-target="#map" hx-swap="outerHTML">
				<label for="name">Name:</label><br>
				<input type="text" id="name" name="name" autocomplete="name" required><br>
				<label for="latitude">Latitude:</label><br>
				<input type="text" id="latitude" name="latitude" autocomplete="latitude" pattern="^-?([1-8]?[1-9]|[1-9]0)\.{1}\d{1,6}" readonly><br> 
				<label for="longitude">Longitude:</label><br>
				<input type="text" id="longitude" name="longitude" autocomplete="longitude" pattern="^-?([1-8]?[1-9]|[1-9]0)\.{1}\d{1,6}" readonly><br>
				<label for="address">Address:</label><br>
				<input type="text" id="address" name="address" autocomplete="address" pattern="^[a-zA-Z0-9\s,.' -]*$"><br>
				<div id="iconGrid" class="icon-grid">
					<i class="fa fa-church" data-value="church"></i>
					<i class="fa fa-industry" data-value="factory"></i>
					<i class="fa fa-fire-extinguisher" data-value="fire_station"></i>
					<i class="fa fa-hospital-symbol" data-value="hospital"></i>
					<i class="fa fa-book" data-value="library"></i>
					<i class="fa fa-landmark" data-value="museum"></i>
					<i class="fa fa-tree" data-value="park"></i>
					<i class="fa fa-shield-alt" data-value="police"></i>
					<i class="fa fa-school" data-value="school"></i>
					<i class="fa fa-store" data-value="store"></i>
					<i class="fa fa-bolt" data-value="power"></i>
				</div>
				<script>
				var observer = new MutationObserver(function(mutations) {
				  mutations.forEach(function(mutation) {
				    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
				      var newNode = mutation.addedNodes[0];
				      if (newNode.id === 'addPinModal') {
					console.log('htmx:afterOnLoad');
				  const iconGrid = document.getElementById('iconGrid');
				  const selectedIconInput = document.getElementById('selectedIcon');

				  iconGrid.addEventListener('click', (e) => {
				    if (e.target.tagName === 'I') {
				      selectedIconInput.value = e.target.dataset.value;
				    }
				  });

				const dialog = document.getElementById('addPinModal');
				const screen = document.getElementById('screen');
				const closeDialog = document.getElementById('closeDialog');
				const latitudeInput = document.getElementById('latitude');
				const longitudeInput = document.getElementById('longitude');

				closeDialog.addEventListener('click', (e) => {
				  e.stopPropagation();
				  dialog.style.display = 'none';
				  screen.style.display = 'none';
				  var pin = map.getLayerById('pin');
				  if (pin) {
				    map.removeLayer(pin);
				  }
				});

				screen.addEventListener('click', (e) => {
				  e.stopPropagation();
				  dialog.style.display = 'none';
				  screen.style.display = 'none';
				  if (pin) {
				    map.removeLayer(pin);
				    pin = null;
				  }
				});

				map.on('click', function(e) {
				  var lat = e.latlng.lat;
				  var lng = e.latlng.lng;
				  latitudeInput.value = lat;
				  longitudeInput.value = lng;
				  dialog.style.display = 'block';
				  screen.style.display = 'block';
				});

				}}});
				</script>
				<input type="hidden" id="selectedIcon" name="icon">

				<input type="submit" value="Submit" class="submit-button">
	        </form>
	    </div>
